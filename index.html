<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>wixdex</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    
    <main>

        <section id="deck-area">

            <div id="lrig-deck">

                <h2>Lrig Deck</h2>
                <div class="card-grid" id="lrig-deck-cards">
                </div>

            </div>

            <div id="main-deck">

                <h2>Main Deck</h2>
                <div class="card-grid" id="main-deck-cards">
                </div>

            </div>

        </section>

        <section id="card-list">

            <div id="cards-container">
            </div>

        </section>

        <section id="search-tool">

            <div id="search-box">検索ツール</div>

        </section>

    </main>

    <script>
        // タッチ開始時のY座標初期値を設定
        let touchStartY = 0;
        // 現在のカードを記録する変数
        let currentCard;
    
        // DOM読込完了時に実行
        document.addEventListener('DOMContentLoaded', () => {
            // cards.jsonを取得
            fetch('cards.json')
                .then(response => response.json())
                .then(responseData => {
                    displayCards(responseData);
                })
                .catch(error => console.error('Error loading card data:', error));
        });
    
        // displayCards関数
        function displayCards(cards) {
            const cardsContainer = document.getElementById('cards-container');
            cards.forEach(card => {
                // cards-containerに追加する<div class="card">を作成
                const cardElement = document.createElement('div');
                cardElement.classList.add('card');
    
                // URLからカード画像を設定
                const cardImage = document.createElement('img');
                cardImage.src = card.image;
                // 画像が表示できなかった場合はカード名を表示
                cardImage.alt = card.name;
    
                // カードをcards-containerに表示
                cardElement.appendChild(cardImage);
                cardsContainer.appendChild(cardElement);
    
                // カードにフリックのリスナーを追加
                cardElement.addEventListener('touchstart', handleTouchStart);
                cardElement.addEventListener('touchend', (event) => {
                    // 現在のカードを記録
                    currentCard = card; 
                    handleTouchEnd(event);
                });
            });
        }
    
        // handleTouchStart関数
        function handleTouchStart(event) {
            // タッチ開始時のY座標を保存
            touchStartY = event.touches[0].clientY;
        }
    
        // handleTouchEnd関数
        function handleTouchEnd(event) {
            // タッチ終了時のY座標を取得し、フリックの距離を計算
            const touchEndY = event.changedTouches[0].clientY;
            const swipeDistance = touchStartY - touchEndY;
    
            // 上方向にフリックされていた場合、addCardToDeck関数を処理
            if (swipeDistance > 50 && currentCard) {
                addCardToDeck(currentCard);
            }
        }
    
        // addCardToDeck関数
        function addCardToDeck(card) {
            // lrig-deck-cardsとmain-deck-cardsをjsで取得
            const lrigDeck = document.getElementById('lrig-deck-cards');
            const mainDeck = document.getElementById('main-deck-cards');
    
            // deckに追加する<div class="card">を作成
            const cardElement = document.createElement('div');
            cardElement.classList.add('card');
    
            // URLからカード画像を設定
            const cardImage = document.createElement('img');
            cardImage.src = card.image;
            cardImage.alt = card.name;
    
            // カード名を表示する<p>要素を作成
            const cardName = document.createElement('p');
            cardName.textContent = card.name;
    
            // cardElementに画像と名前を追加
            cardElement.appendChild(cardImage);
            cardElement.appendChild(cardName);
    
            // カード種類の最初の要素を取得
            const cardType = card.type[0];
    
            // カードの種類に応じてデッキに追加
            if (['ルリグ', 'アシストルリグ', 'ピース', 'アーツ'].includes(cardType)) {
                if (lrigDeck.children.length >= 7) {
                    console.log(`Cannot add ${card.name} to Lrig Deck: Deck is full`);
                    return;
                }
                lrigDeck.appendChild(cardElement);
                console.log(`Added ${card.name} to Lrig Deck`);
                sortLrigDeck();
            } else if (['シグニ', 'スペル'].includes(cardType)) {
                if (mainDeck.children.length >= 40) {
                    console.log(`Cannot add ${card.name} to Main Deck: Deck is full`);
                    return;
                }
                mainDeck.appendChild(cardElement);
                console.log(`Added ${card.name} to Main Deck`);
            } else {
                console.log(`Card type ${cardType} is not recognized`);
            }
    
            // ルリグデッキとメインデッキのカードに削除のフリックイベントを追加
            cardElement.addEventListener('touchstart', handleTouchStart);
            cardElement.addEventListener('touchend', handleRemoveTouchEnd);
        }

        // デッキからカードを削除する関数
        function removeCardFromDeck(cardElement) {
            const lrigDeck = document.getElementById('lrig-deck-cards');
            const mainDeck = document.getElementById('main-deck-cards');
    
            if (lrigDeck.contains(cardElement)) {
                lrigDeck.removeChild(cardElement);
                console.log('Card removed from Lrig Deck');
                sortLrigDeck();
            } else if (mainDeck.contains(cardElement)) {
                mainDeck.removeChild(cardElement);
                console.log('Card removed from Main Deck');
            }
        }
    
        // 削除用のhandleTouchEnd関数
        function handleRemoveTouchEnd(event) {
            // タッチ終了時のY座標を取得し、フリックの距離を計算
            const touchEndY = event.changedTouches[0].clientY;
            const swipeDistance = touchEndY - touchStartY;
    
            // 下方向にスワイプされた場合、カードを削除
            if (swipeDistance > 50 && event.currentTarget) {
                removeCardFromDeck(event.currentTarget);
            }
        }
    
        // ルリグデッキをソートする関数
        function sortLrigDeck() {
            // ルリグデッキの要素を取得
            const lrigDeck = document.getElementById('lrig-deck-cards');
            // ルリグデッキ内のすべてのカード要素を取得し、配列に変換
            const cardElements = Array.from(lrigDeck.children);

            // デバッグ: ソート前のカード情報
            console.log('Before sorting:', cardElements.map(card => card.querySelector('p').textContent));

            // カードの種類に基づく順序を定義
            const order = {
                'ルリグ': 0,
                'アシストルリグ': 1,
                'ピース': 2,
                'アーツ': 3
            };

            // ソート処理
            cardElements.sort((a, b) => {
                // 各カード要素から種類を取得
                const aType = order[a.querySelector('p').textContent.split(' ')[0]] || 4;
                const bType = order[b.querySelector('p').textContent.split(' ')[0]] || 4;

                // 順序に基づいて比較
                return aType - bType;
            });

            // 一旦全ての子要素を削除してから、ソート済みの要素を再追加
            lrigDeck.innerHTML = '';
            cardElements.forEach(element => lrigDeck.appendChild(element));

            // デバッグ: ソート後のカード情報
            console.log('After sorting:', Array.from(lrigDeck.children).map(card => card.querySelector('p').textContent));
        }

    
    </script>
    
</body>

</html>
